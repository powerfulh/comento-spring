<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.comento.oracleSpringBoot.mapper.PlmMapper">
	<select id="selectWord" resultType="com.comento.oracleSpringBoot.dto.plm.Word">SELECT * FROM llm_word w where w.word = #{s}</select>
    <select id="selectCompounded" resultType="com.comento.oracleSpringBoot.dto.plm.Compound">
        select c.n, c.word, c.leftword, c.rightword, w.word cw, lw.word lw, rw.word rw
        from llm_word_compound c, llm_word w, llm_word lw, llm_word rw
        where #{n} in (c.leftword , c.rightword)
        and c.word = w.n
        and c.leftword = lw.n
        and c.rightword = rw.n
    </select>
    <select id="selectLeftRight" resultType="com.comento.oracleSpringBoot.dto.plm.Word">
        select w.* from llm_word w, llm_word_compound c
        where w.n = c.leftword and c.word = #{n}
        or w.n = c.rightword and c.word = #{n}
    </select>
    <select id="selectLearn" resultType="map">select * from plm_learn l order by l.n desc limit 100</select>
    <select id="selectOneLearn" resultType="map">select * from plm_learn l where l.word = #{n}</select>

    <insert id="insertWord" parameterType="com.comento.oracleSpringBoot.dto.plm.Word">
        insert into llm_word(word, type, memo) values(#{word}, #{type}, #{wordMemo})
    </insert>
    <insert id="insertCompound" parameterType="com.comento.oracleSpringBoot.dto.plm.Compound">
        INSERT into llm_word_compound (word, leftword, rightword) values(#{word}, #{leftword}, #{rightword})
        on duplicate key update leftword = #{leftword}, rightword = #{rightword}, updated_date = now()
    </insert>

    <delete id="deleteLearn">delete from plm_learn where word = #{n}</delete>
    <delete id="deleteCanceledWord">delete from llm_word where type like '학습%' and not exists(select 1 from plm_learn l where l.word = llm_word.n)</delete>
</mapper>